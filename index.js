const email = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional //EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n" +
    "<!--[if IE]><html xmlns=\"http://www.w3.org/1999/xhtml\" class=\"ie\"><![endif]-->\n" +
    "<!--[if !IE]><!-->\n" +
    "<html style=\"margin: 0;padding: 0;\" xmlns=\"http://www.w3.org/1999/xhtml\">\n" +
    "<!--<![endif]-->\n" +
    "<head>\n" +
    "    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n" +
    "    <title></title>\n" +
    "    <!--[if !mso]><!-->\n" +
    "    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n" +
    "    <!--<![endif]-->\n" +
    "    <meta name=\"viewport\" content=\"width=device-width\">\n" +
    "    <style type=\"text/css\">\n" +
    "    @media only screen and (min-width: 620px) {\n" +
    "        .wrapper {\n" +
    "            min-width:600px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h1 {\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h1 {\n" +
    "            font-size: 36px !important;\n" +
    "            line-height:43px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h2 {\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h2 {\n" +
    "            font-size: 24px !important;\n" +
    "            line-height:32px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h3 {\n" +
    "        }\n" +
    "\n" +
    "        .wrapper h3 {\n" +
    "            font-size: 20px !important;\n" +
    "            line-height:28px !important\n" +
    "        }\n" +
    "\n" +
    "        .column {\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-8 {\n" +
    "            font-size: 8px !important;\n" +
    "            line-height:14px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-9 {\n" +
    "            font-size: 9px !important;\n" +
    "            line-height:16px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-10 {\n" +
    "            font-size: 10px !important;\n" +
    "            line-height:18px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-11 {\n" +
    "            font-size: 11px !important;\n" +
    "            line-height:19px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-12 {\n" +
    "            font-size: 12px !important;\n" +
    "            line-height:19px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-13 {\n" +
    "            font-size: 13px !important;\n" +
    "            line-height:21px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-14 {\n" +
    "            font-size: 14px !important;\n" +
    "            line-height:21px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-15 {\n" +
    "            font-size: 15px !important;\n" +
    "            line-height: 23px\n" +
    "            !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-16 {\n" +
    "            font-size: 16px !important;\n" +
    "            line-height:24px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-17 {\n" +
    "            font-size: 17px !important;\n" +
    "            line-height:26px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-18 {\n" +
    "            font-size: 18px !important;\n" +
    "            line-height:26px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-20 {\n" +
    "            font-size: 20px !important;\n" +
    "            line-height:28px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-22 {\n" +
    "            font-size: 22px !important;\n" +
    "            line-height:31px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-24 {\n" +
    "            font-size: 24px !important;\n" +
    "            line-height:32px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-26 {\n" +
    "            font-size: 26px !important;\n" +
    "            line-height:34px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-28 {\n" +
    "            font-size: 28px !important;\n" +
    "            line-height:36px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-30 {\n" +
    "            font-size: 30px !important;\n" +
    "            line-height:38px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-32 {\n" +
    "            font-size: 32px !important;\n" +
    "            line-height:40px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-34 {\n" +
    "            font-size: 34px !important;\n" +
    "            line-height:43px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-36 {\n" +
    "            font-size: 36px !important;\n" +
    "            line-height: 43px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper\n" +
    "        .size-40 {\n" +
    "            font-size: 40px !important;\n" +
    "            line-height:47px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-44 {\n" +
    "            font-size: 44px !important;\n" +
    "            line-height:50px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-48 {\n" +
    "            font-size: 48px !important;\n" +
    "            line-height:54px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-56 {\n" +
    "            font-size: 56px !important;\n" +
    "            line-height:60px !important\n" +
    "        }\n" +
    "\n" +
    "        .wrapper .size-64 {\n" +
    "            font-size: 64px !important;\n" +
    "            line-height: 63px !important\n" +
    "        }\n" +
    "    }\n" +
    "    </style>\n" +
    "    <meta name=\"x-apple-disable-message-reformatting\">\n" +
    "    <style type=\"text/css\">\n" +
    "    body {\n" +
    "        margin: 0;\n" +
    "        padding: 0;\n" +
    "    }\n" +
    "\n" +
    "    table {\n" +
    "        border-collapse: collapse;\n" +
    "        table-layout: fixed;\n" +
    "    }\n" +
    "\n" +
    "    * {\n" +
    "        line-height: inherit;\n" +
    "    }\n" +
    "\n" +
    "    [x-apple-data-detectors] {\n" +
    "        color: inherit !important;\n" +
    "        text-decoration: none !important;\n" +
    "    }\n" +
    "\n" +
    "    .wrapper .footer__share-button a:hover, .wrapper .footer__share-button a:focus {\n" +
    "        color: #ffffff !important;\n" +
    "    }\n" +
    "\n" +
    "    .btn a:hover, .btn a:focus, .footer__share-button a:hover, .footer__share-button a:focus, .email-footer__links a:hover, .email-footer__links a:focus {\n" +
    "        opacity: 0.8;\n" +
    "    }\n" +
    "\n" +
    "    .preheader, .header, .layout, .column {\n" +
    "        transition: width 0.25s ease-in-out, max-width 0.25s ease-in-out;\n" +
    "    }\n" +
    "\n" +
    "    .preheader td {\n" +
    "        padding-bottom: 8px;\n" +
    "    }\n" +
    "\n" +
    "    .layout, div.header {\n" +
    "        max-width: 400px !important;\n" +
    "        -fallback-width: 95% !important;\n" +
    "        width: calc(100% - 20px) !important;\n" +
    "    }\n" +
    "\n" +
    "    div.preheader {\n" +
    "        max-width: 360px !important;\n" +
    "        -fallback-width: 90% !important;\n" +
    "        width: calc(100% - 60px) !important;\n" +
    "    }\n" +
    "\n" +
    "    .snippet, .webversion {\n" +
    "        Float: none !important;\n" +
    "    }\n" +
    "\n" +
    "    .stack .column {\n" +
    "        max-width: 400px !important;\n" +
    "        width: 100% !important;\n" +
    "    }\n" +
    "\n" +
    "    .fixed-width.has-border {\n" +
    "        max-width: 402px !important;\n" +
    "    }\n" +
    "\n" +
    "    .fixed-width.has-border .layout__inner {\n" +
    "        box-sizing: border-box;\n" +
    "    }\n" +
    "\n" +
    "    .snippet, .webversion {\n" +
    "        width: 50% !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .btn {\n" +
    "        width: 100%;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack .column, .ie .stack .gutter {\n" +
    "        display: table-cell;\n" +
    "        float: none !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie div.preheader, .ie .email-footer {\n" +
    "        max-width: 560px !important;\n" +
    "        width: 560px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .snippet, .ie .webversion {\n" +
    "        width: 280px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie div.header, .ie .layout {\n" +
    "        max-width: 600px !important;\n" +
    "        width: 600px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .two-col .column {\n" +
    "        max-width: 300px !important;\n" +
    "        width: 300px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .three-col .column, .ie .narrow {\n" +
    "        max-width: 200px !important;\n" +
    "        width: 200px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .wide {\n" +
    "        width: 400px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.fixed-width.has-border, .ie .stack.has-gutter.has-border {\n" +
    "        max-width: 602px !important;\n" +
    "        width: 602px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.two-col.has-gutter .column {\n" +
    "        max-width: 290px !important;\n" +
    "        width: 290px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.three-col.has-gutter .column, .ie .stack.has-gutter .narrow {\n" +
    "        max-width: 188px !important;\n" +
    "        width: 188px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.has-gutter .wide {\n" +
    "        max-width: 394px !important;\n" +
    "        width: 394px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.two-col.has-gutter.has-border .column {\n" +
    "        max-width: 292px !important;\n" +
    "        width: 292px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.three-col.has-gutter.has-border .column, .ie .stack.has-gutter.has-border .narrow {\n" +
    "        max-width: 190px !important;\n" +
    "        width: 190px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .stack.has-gutter.has-border .wide {\n" +
    "        max-width: 396px !important;\n" +
    "        width: 396px !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .fixed-width .layout__inner {\n" +
    "        border-left: 0 none white !important;\n" +
    "        border-right: 0 none white !important;\n" +
    "    }\n" +
    "\n" +
    "    .ie .layout__edges {\n" +
    "        display: none;\n" +
    "    }\n" +
    "\n" +
    "    .mso .layout__edges {\n" +
    "        font-size: 0;\n" +
    "    }\n" +
    "\n" +
    "    .layout-fixed-width, .mso .layout-full-width {\n" +
    "        background-color: #ffffff;\n" +
    "    }\n" +
    "\n" +
    "    @media only screen and (min-width: 620px) {\n" +
    "        .column, .gutter {\n" +
    "            display: table-cell;\n" +
    "            Float: none !important;\n" +
    "            vertical-align: top;\n" +
    "        }\n" +
    "\n" +
    "        div.preheader, .email-footer {\n" +
    "            max-width: 560px !important;\n" +
    "            width: 560px !important;\n" +
    "        }\n" +
    "\n" +
    "        .snippet, .webversion {\n" +
    "            width: 280px !important;\n" +
    "        }\n" +
    "\n" +
    "        div.header, .layout, .one-col .column {\n" +
    "            max-width: 600px !important;\n" +
    "            width: 600px !important;\n" +
    "        }\n" +
    "\n" +
    "        .fixed-width.has-border, .fixed-width.x_has-border, .has-gutter.has-border, .has-gutter.x_has-border {\n" +
    "            max-width: 602px !important;\n" +
    "            width: 602px !important;\n" +
    "        }\n" +
    "\n" +
    "        .two-col .column {\n" +
    "            max-width: 300px !important;\n" +
    "            width: 300px !important;\n" +
    "        }\n" +
    "\n" +
    "        .three-col .column, .column.narrow, .column.x_narrow {\n" +
    "            max-width: 200px !important;\n" +
    "            width: 200px !important;\n" +
    "        }\n" +
    "\n" +
    "        .column.wide, .column.x_wide {\n" +
    "            width: 400px !important;\n" +
    "        }\n" +
    "\n" +
    "        .two-col.has-gutter .column, .two-col.x_has-gutter .column {\n" +
    "            max-width: 290px !important;\n" +
    "            width: 290px !important;\n" +
    "        }\n" +
    "\n" +
    "        .three-col.has-gutter .column, .three-col.x_has-gutter .column, .has-gutter .narrow {\n" +
    "            max-width: 188px !important;\n" +
    "            width: 188px !important;\n" +
    "        }\n" +
    "\n" +
    "        .has-gutter .wide {\n" +
    "            max-width: 394px !important;\n" +
    "            width: 394px !important;\n" +
    "        }\n" +
    "\n" +
    "        .two-col.has-gutter.has-border .column, .two-col.x_has-gutter.x_has-border .column {\n" +
    "            max-width: 292px !important;\n" +
    "            width: 292px !important;\n" +
    "        }\n" +
    "\n" +
    "        .three-col.has-gutter.has-border .column, .three-col.x_has-gutter.x_has-border .column, .has-gutter.has-border .narrow, .has-gutter.x_has-border .narrow {\n" +
    "            max-width: 190px !important;\n" +
    "            width: 190px !important;\n" +
    "        }\n" +
    "\n" +
    "        .has-gutter.has-border .wide, .has-gutter.x_has-border .wide {\n" +
    "            max-width: 396px !important;\n" +
    "            width: 396px !important;\n" +
    "        }\n" +
    "    }\n" +
    "\n" +
    "    @supports (display: flex) {\n" +
    "        @media only screen and (min-width: 620px) {\n" +
    "            .fixed-width.has-border .layout__inner {\n" +
    "                display: flex !important;\n" +
    "            }\n" +
    "        }\n" +
    "    }\n" +
    "\n" +
    "    @media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and(min--moz-device-pixel-ratio: 2), only screen and(-o-min-device-pixel-ratio: 2/1), only screen and(min-device-pixel-ratio: 2), only screen and(min-resolution: 192dpi), only screen and(min-resolution: 2dppx) {\n" +
    "        .fblike {\n" +
    "            background-image: url(https://i7.createsend1.com/static/eb/master/13-the-blueprint-3/images/fblike@2x.png) !important;\n" +
    "        }\n" +
    "\n" +
    "        .tweet {\n" +
    "            background-image: url(https://i8.createsend1.com/static/eb/master/13-the-blueprint-3/images/tweet@2x.png) !important;\n" +
    "        }\n" +
    "\n" +
    "        .linkedinshare {\n" +
    "            background-image: url(https://i9.createsend1.com/static/eb/master/13-the-blueprint-3/images/lishare@2x.png) !important;\n" +
    "        }\n" +
    "\n" +
    "        .forwardtoafriend {\n" +
    "            background-image: url(https://i10.createsend1.com/static/eb/master/13-the-blueprint-3/images/forward@2x.png) !important;\n" +
    "        }\n" +
    "    }\n" +
    "\n" +
    "    @media (max-width: 321px) {\n" +
    "        .fixed-width.has-border .layout__inner {\n" +
    "            border-width: 1px 0 !important;\n" +
    "        }\n" +
    "\n" +
    "        .layout, .stack .column {\n" +
    "            min-width: 320px !important;\n" +
    "            width: 320px !important;\n" +
    "        }\n" +
    "\n" +
    "        .border {\n" +
    "            display: none;\n" +
    "        }\n" +
    "\n" +
    "        .has-gutter .border {\n" +
    "            display: table-cell;\n" +
    "        }\n" +
    "    }\n" +
    "\n" +
    "    .mso div {\n" +
    "        border: 0 none white !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w560 .divider {\n" +
    "        Margin-left: 260px !important;\n" +
    "        Margin-right: 260px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w360 .divider {\n" +
    "        Margin-left: 160px !important;\n" +
    "        Margin-right: 160px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w260 .divider {\n" +
    "        Margin-left: 110px !important;\n" +
    "        Margin-right: 110px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w160 .divider {\n" +
    "        Margin-left: 60px !important;\n" +
    "        Margin-right: 60px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w354 .divider {\n" +
    "        Margin-left: 157px !important;\n" +
    "        Margin-right: 157px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w250 .divider {\n" +
    "        Margin-left: 105px !important;\n" +
    "        Margin-right: 105px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .w148 .divider {\n" +
    "        Margin-left: 54px !important;\n" +
    "        Margin-right: 54px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-8, .ie .size-8 {\n" +
    "        font-size: 8px !important;\n" +
    "        line-height: 14px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-9, .ie .size-9 {\n" +
    "        font-size: 9px !important;\n" +
    "        line-height: 16px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-10, .ie .size-10 {\n" +
    "        font-size: 10px !important;\n" +
    "        line-height: 18px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-11, .ie .size-11 {\n" +
    "        font-size: 11px !important;\n" +
    "        line-height: 19px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-12, .ie .size-12 {\n" +
    "        font-size: 12px !important;\n" +
    "        line-height: 19px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-13, .ie .size-13 {\n" +
    "        font-size: 13px !important;\n" +
    "        line-height: 21px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-14, .ie .size-14 {\n" +
    "        font-size: 14px !important;\n" +
    "        line-height: 21px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-15, .ie .size-15 {\n" +
    "        font-size: 15px !important;\n" +
    "        line-height: 23px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-16, .ie .size-16 {\n" +
    "        font-size: 16px !important;\n" +
    "        line-height: 24px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-17, .ie .size-17 {\n" +
    "        font-size: 17px !important;\n" +
    "        line-height: 26px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-18, .ie .size-18 {\n" +
    "        font-size: 18px !important;\n" +
    "        line-height: 26px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-20, .ie .size-20 {\n" +
    "        font-size: 20px !important;\n" +
    "        line-height: 28px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-22, .ie .size-22 {\n" +
    "        font-size: 22px !important;\n" +
    "        line-height: 31px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-24, .ie .size-24 {\n" +
    "        font-size: 24px !important;\n" +
    "        line-height: 32px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-26, .ie .size-26 {\n" +
    "        font-size: 26px !important;\n" +
    "        line-height: 34px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-28, .ie .size-28 {\n" +
    "        font-size: 28px !important;\n" +
    "        line-height: 36px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-30, .ie .size-30 {\n" +
    "        font-size: 30px !important;\n" +
    "        line-height: 38px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-32, .ie .size-32 {\n" +
    "        font-size: 32px !important;\n" +
    "        line-height: 40px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-34, .ie .size-34 {\n" +
    "        font-size: 34px !important;\n" +
    "        line-height: 43px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-36, .ie .size-36 {\n" +
    "        font-size: 36px !important;\n" +
    "        line-height: 43px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-40, .ie .size-40 {\n" +
    "        font-size: 40px !important;\n" +
    "        line-height: 47px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-44, .ie .size-44 {\n" +
    "        font-size: 44px !important;\n" +
    "        line-height: 50px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-48, .ie .size-48 {\n" +
    "        font-size: 48px !important;\n" +
    "        line-height: 54px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-56, .ie .size-56 {\n" +
    "        font-size: 56px !important;\n" +
    "        line-height: 60px !important;\n" +
    "    }\n" +
    "\n" +
    "    .mso .size-64, .ie .size-64 {\n" +
    "        font-size: 64px !important;\n" +
    "        line-height: 63px !important;\n" +
    "    }\n" +
    "    </style>\n" +
    "\n" +
    "    <style type=\"text/css\">\n" +
    "    body {\n" +
    "        background-color:#fff\n" +
    "    }\n" +
    "\n" +
    "    .logo a:hover, .logo a:focus {\n" +
    "        color:#1e2e3b !important\n" +
    "    }\n" +
    "\n" +
    "    .mso .layout-has-border {\n" +
    "        border-top: 1px solid #ccc;\n" +
    "        border-bottom:1px solid #ccc\n" +
    "    }\n" +
    "\n" +
    "    .mso .layout-has-bottom-border {\n" +
    "        border-bottom:1px solid #ccc\n" +
    "    }\n" +
    "\n" +
    "    .mso .border, .ie .border {\n" +
    "        background-color:#ccc\n" +
    "    }\n" +
    "\n" +
    "    .mso h1, .ie h1 {\n" +
    "    }\n" +
    "\n" +
    "    .mso h1, .ie h1 {\n" +
    "        font-size: 36px !important;\n" +
    "        line-height:43px !important\n" +
    "    }\n" +
    "\n" +
    "    .mso h2, .ie h2 {\n" +
    "    }\n" +
    "\n" +
    "    .mso h2, .ie h2 {\n" +
    "        font-size: 24px !important;\n" +
    "        line-height:32px !important\n" +
    "    }\n" +
    "\n" +
    "    .mso h3, .ie h3 {\n" +
    "    }\n" +
    "\n" +
    "    .mso h3, .ie h3 {\n" +
    "        font-size: 20px !important;\n" +
    "        line-height:28px !important\n" +
    "    }\n" +
    "\n" +
    "    .mso .layout__inner, .ie .layout__inner {\n" +
    "    }\n" +
    "\n" +
    "    .mso .footer__share-button p {\n" +
    "    }\n" +
    "\n" +
    "    .mso .footer__share-button p {\n" +
    "        font-family: sans-serif\n" +
    "    }\n" +
    "    </style>\n" +
    "    <meta name=\"robots\" content=\"noindex,nofollow\">\n" +
    "    </meta>\n" +
    "    <meta property=\"og:title\" content=\"Ease Attendance - Message\">\n" +
    "    </meta>\n" +
    "</head>\n" +
    "<!--[if mso]>\n" +
    "  <body class=\"mso\">\n" +
    "<![endif]-->\n" +
    "<!--[if !mso]><!-->\n" +
    "<body class=\"full-padding\" style=\"margin: 0;padding: 0;-webkit-text-size-adjust: 100%;\">\n" +
    "    <!--<![endif]-->\n" +
    "    <table class=\"wrapper\" style=\"border-collapse: collapse;table-layout: fixed;min-width: 320px;width: 100%;background-color: #fff;\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\n" +
    "        <tbody>\n" +
    "            <tr>\n" +
    "                <td>\n" +
    "                    <div role=\"banner\">\n" +
    "                        <div class=\"preheader\" style=\"Margin: 0 auto;max-width: 560px;min-width: 280px; width: 280px;width: calc(28000% - 167440px);\">\n" +
    "                            <div style=\"border-collapse: collapse;display: table;width: 100%;\">\n" +
    "                                <!--[if (mso)|(IE)]><table align=\"center\" class=\"preheader\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\"><tr><td style=\"width: 280px\" valign=\"top\"><![endif]-->\n" +
    "                                <div class=\"snippet\" style=\"display: table-cell;Float: left;font-size: 12px;line-height: 19px;max-width: 280px;min-width: 140px; width: 140px;width: calc(14000% - 78120px);padding: 10px 0 5px 0;color: #999;font-family: sans-serif;\">\n" +
    "                                </div>\n" +
    "\n" +
    "                            </div>\n" +
    "                        </div>\n" +
    "                        <div class=\"header\" style=\"Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);\" id=\"emb-email-header-container\">\n" +
    "                            <!--[if (mso)|(IE)]><table align=\"center\" class=\"header\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\"><tr><td style=\"width: 600px\"><![endif]-->\n" +
    "                            <div class=\"logo emb-logo-margin-box\" style=\"font-size: 26px;line-height: 32px;Margin-top: 16px;Margin-bottom: 24px;color: #41637e;font-family: sans-serif;Margin-left: 20px;Margin-right: 20px;\" align=\"center\">\n" +
    "                                <div class=\"logo-left\" align=\"left\" id=\"emb-email-header\">\n" +
    "                                    <img style=\"display: block;height: auto;width: 100%;border: 0;max-width: 190px;\" src=\"https://i1.createsend1.com/ei/t/E3/266/A20/110828/csfinal/Logo.png\" alt=\"\" width=\"190\">\n" +
    "                                </div>\n" +
    "                            </div>\n" +
    "                            <!--[if (mso)|(IE)]></td></tr></table><![endif]-->\n" +
    "                        </div>\n" +
    "                    </div>\n" +
    "                    <div>\n" +
    "                        <div class=\"layout one-col fixed-width stack\" style=\"Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;\">\n" +
    "                            <div class=\"layout__inner\" style=\"border-collapse: collapse;display: table;width: 100%;background-color: #ffffff;\">\n" +
    "                                <!--[if (mso)|(IE)]><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\"><tr class=\"layout-fixed-width\" style=\"background-color: #ffffff;\"><td style=\"width: 600px\" class=\"w560\"><![endif]-->\n" +
    "                                <div class=\"column\" style=\"text-align: left;color: #717a8a;font-size: 16px;line-height: 24px;font-family: sans-serif;\">\n" +
    "\n" +
    "                                    <div style=\"Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;\">\n" +
    "                                        <div style=\"mso-line-height-rule: exactly;line-height: 8px;font-size: 1px;\">&nbsp;</div>\n" +
    "                                    </div>\n" +
    "\n" +
    "                                    <div style=\"Margin-left: 20px;Margin-right: 20px;\">\n" +
    "                                        <div style=\"mso-line-height-rule: exactly;line-height: 16px;font-size: 1px;\">&nbsp;</div>\n" +
    "                                    </div>\n" +
    "\n" +
    "                                    <div style=\"Margin-left: 20px;Margin-right: 20px;\">\n" +
    "                                        <div style=\"mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;\">\n" +
    "                                            <h3 style=\"Margin-top: 0;Margin-bottom: 0;font-style: normal;font-weight: normal;color: #3d3b3d;font-size: 17px;line-height: 26px;\">Thank you for your message,</h3>\n" +
    "                                            <p style=\"Margin-top: 12px;Margin-bottom: 20px;\">Please give us up to 24 hours to get back to you.</p>\n" +
    "                                        </div>\n" +
    "                                    </div>\n" +
    "\n" +
    "                                    <div style=\"Margin-left: 20px;Margin-right: 20px;\">\n" +
    "                                        <div style=\"mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;\">\n" +
    "                                            <p style=\"Margin-top: 0;Margin-bottom: 0;\">Thank you for your patience,</p>\n" +
    "                                            <p style=\"Margin-top: 20px;Margin-bottom: 20px;\">Ease Attendance</p>\n" +
    "                                        </div>\n" +
    "                                    </div>\n" +
    "\n" +
    "                                    <div style=\"Margin-left: 20px;Margin-right: 20px;\">\n" +
    "                                        <div style=\"mso-line-height-rule: exactly;line-height: 24px;font-size: 1px;\">&nbsp;</div>\n" +
    "                                    </div>\n" +
    "\n" +
    "                                    <div style=\"font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;\" align=\"center\">\n" +
    "                                        <img class=\"gnd-corner-image gnd-corner-image-center gnd-corner-image-bottom\" style=\"border: 0;display: block;height: auto;width: 100%;max-width: 900px;\" alt=\"\" width=\"600\" src=\"https://i1.createsend1.com/ei/t/E3/266/A20/110828/csfinal/divider-1px3-9900000000079e3c.png\">\n" +
    "                                    </div>\n" +
    "\n" +
    "                                </div>\n" +
    "                                <!--[if (mso)|(IE)]></td></tr></table><![endif]-->\n" +
    "                            </div>\n" +
    "                        </div>\n" +
    "\n" +
    "                        <div style=\"mso-line-height-rule: exactly;line-height: 20px;font-size: 20px;\">&nbsp;</div>\n" +
    "\n" +
    "                    </div>\n" +
    "\n" +
    "                    <div style=\"line-height:40px;font-size:40px;\">&nbsp;</div>\n" +
    "                </td>\n" +
    "            </tr>\n" +
    "        </tbody>\n" +
    "    </table>\n" +
    "\n" +
    "</body>\n"
const port = process.env.PORT || 4000
require('dotenv').config()
console.log("env loaded")
const express = require('express')
console.log("express loaded")
const bodyParser = require('body-parser')
console.log("body-parser loaded")
const request = require('request')
console.log("request loaded")
const path = require('path')
console.log("path loaded")
const app = express()
console.log("app created")
//serverside read and write Admin:
const admin = require('firebase-admin')
console.log("firebase-admin loaded")
console.log("service account configuration loaded")
const nodemailer = require("nodemailer")
console.log("nodemailer loaded")
const favicon = require('serve-favicon')
console.log("favicon module loaded")
admin.initializeApp({
  credential: admin.credential.cert({
          "type": "service_account",
          "project_id": "easeattendance-c68ed",
          "private_key_id": process.env.firebase_admin_key_id,
          "private_key": process.env.firebase_admin_key,
          "client_email": "easeattendance-c68ed@appspot.gserviceaccount.com",
          "client_id": process.env.firebase_admin_client_id,
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token",
          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/easeattendance-c68ed%40appspot.gserviceaccount.com"
      }
  )
})
console.log("admin app created")
const db = admin.firestore();
console.log("db loaded")

class Meeting{
  constructor(hostId,meetingName,hostEmail, id) {
    this.meetingId = id
    this.hostId = hostId
    this.meetingName = meetingName
    this.hostEmail = hostEmail
    this.hostUID = null
    this.messageLog = []
    this.recordLog = []
    this.meetingStart = new Date()
  }
}
//TODO: test for host change
//TODO: remove occurrences of client
//TODO: only keep errors

// current meetings going on
Meetings = {}
const transporter = nodemailer.createTransport({
  service: 'gmail',
  auth: {
    user: process.env.admin_email,
    pass: process.env.admin_pass
  }
});


app.use(favicon(path.join(__dirname, 'favicon.ico')))
app.use(express.urlencoded({
  extended: true
}))
app.use(bodyParser.json())
app.use(express.static(path.join(__dirname, '/public')));
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname + '/index.html'));
})
app.get('/features', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/features.html'));
})

app.get('/about-us', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/about-us.html'));
})

app.get('/privacy', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/privacy.html'));
})

app.get('/terms', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/terms.html'));
})

app.get('/getting-started', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/getting-started.html'));
})
app.get('/dashboard', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/dashboard.html'));
})
app.get('/forgotpass', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/forgotpass.html'));
})
app.get('/login', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/login.html'));
})
app.get('/signup', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/signup.html'));
})
app.get('/support', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/support.html'));
})
app.get('/verify', (req, res) => {
    res.sendFile(path.join(__dirname + '/public/verify.html'));
})


app.get('/authorize', (req, res) => {

})

app.post('/support-message', (req,res) => {

  console.log(req.body)
  const message = "email from: " + req.body.email + " with name: " + req.body.Name + " with message: " + req.body.message
  var mailOptions = {
    from: process.env.admin_email,
    to: process.env.admin_email,
    subject: 'Support Email from Ease Attendance: ' + req.body.email,
    text: message
  };
  var mailOptionsUser = {
    from: process.env.admin_email,
    to: req.body.email,
    subject: "Ease Attendance Support",
    html: email
  };
  if(req.body.email){
    transporter.sendMail(mailOptions, function(error, info){
      if (error) {
        console.log(error);
      } else {
        console.log('Email sent: ' + info.response);
      }
    });
    transporter.sendMail(mailOptionsUser, function(error, info){
      if (error) {
        console.log(error);
      } else {
        console.log('Email sent: ' + info.response);
      }
    });
  }

  res.status(200);
  res.send()

})
app.get('/zoomverify/verifyzoom.html', (req, res) => {
  res.send(process.env.zoom_verification_code)
})
function remove(array, element) {
  const index = array.indexOf(element);

  if (index !== -1) {
    array.splice(index, 1);
  }
}
function handleZoomPost(req){
    const body = req.body
    const host_id = body.payload.object.host_id
    console.log("<====================================================>")
    console.log(req.body)
    console.log(req.body.payload.object.participant)
    console.log("<====================================================>")


    if(body.event === "meeting.started"){
        // note: do not update firebase current meetings since we do not know who started the meeting yet
        // Create meeting in meeting dictionary
        Meetings[host_id] = new Meeting(host_id, body.payload.object.topic, null, body.payload.object.id)
        // Add meeting started to record log
        let currentDate = new Date()
        Meetings[host_id].recordLog.push("Meeting: " + body.payload.object.topic + " has started " + "with ID: " + body.payload.object.id + "  " + currentDate)
        // push messages that set meeting ID and meeting Name in front end
        Meetings[host_id].messageLog.push("meeting.id " + body.payload.object.id)
        Meetings[host_id].messageLog.push("meeting.started " + body.payload.object.topic)
    }
    else if(body.event === "meeting.participant_joined"){
        const participant = body.payload.object.participant
        const participantID = participant.id
        const participantName = participant.user_name
        const participantEmail = participant.email
        if(Meetings[host_id]){
            let currentDate = new Date()
            if(participantID === host_id){
                db.collection("Users").where("email","==",participantEmail).get().then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        Meetings[host_id].hostUID = doc.id
                        console.log("host uid is " + doc.id)
                        Meetings[host_id].hostEmail = participantEmail
                        Meetings[host_id].recordLog.push(participantName +  " has joined" + "  " + currentDate)
                        Meetings[host_id].messageLog.push("participant.joined " + participantName)
                        db.collection("CurrentMeetings").doc(Meetings[host_id].hostUID).set({
                            messages: Meetings[host_id].messageLog
                        }).then(()=>{
                        }).catch((error)=>{
                            console.error("error updating current meeting" + " email: " + participantEmail + " in meeting participant joined")
                        })
                    })
                }).catch((error) => {
                    console.error("error getting user uid from collection based on email" + " email: " + participantEmail)
                })
            }
            else{
                if(Meetings[host_id].hostEmail == null || Meetings[host_id].hostEmail === ""){
                    Meetings[host_id].recordLog.push(participantName +  " has joined" + "  " + currentDate)
                    Meetings[host_id].messageLog.push("participant.joined " + participantName)
                }
                else{
                    Meetings[host_id].recordLog.push(participantName +  " has joined" + "  " + currentDate)
                    Meetings[host_id].messageLog.push("participant.joined " + participantName)
                    db.collection("CurrentMeetings").doc(Meetings[host_id].hostUID).set({
                        messages: Meetings[host_id].messageLog
                    }).then(()=>{
                    }).catch((error)=>{
                        console.error("error updating current meeting" + " email: " + participantEmail + " in meeting participant joined")
                    })
                }
            }
        }
    }
    else if(body.event === "meeting.participant_left"){
        const participant = body.payload.object.participant
        const participantID = participant.id
        const participantName = participant.user_name
        const participantEmail = participant.email
        let currentDate = new Date()
        if(Meetings[host_id]){
            if(Meetings[host_id].hostEmail){
                Meetings[host_id].recordLog.push(participantName +  " has left" + "  " + currentDate)
                Meetings[host_id].messageLog.push("participant.left " + participantName)
                db.collection("CurrentMeetings").doc(Meetings[host_id].hostUID).set({
                    messages: Meetings[host_id].messageLog
                }).then(()=>{
                }).catch((error)=>{
                    console.error("error updating current meeting" + " email: " + participantEmail + " in meeting participant joined")
                })
            }
            else{
                Meetings[host_id].recordLog.push(participantName +  " has left" + "  " + currentDate)
                Meetings[host_id].messageLog.push("participant.left " + participantName)
            }
        }
    }
    else if(body.event === "meeting.ended"){
      // If meeting exists and participant is know
      if(Meetings[host_id] && Meetings[host_id].hostEmail){
          // Add meeting end to record log
        let currentDate = new Date()
        Meetings[host_id].recordLog.push("Meeting: " + body.payload.object.topic + " has ended " + "with ID: " + body.payload.object.id + "  " + currentDate);
        // find the host id based on host email
        db.collection("Users").where("email", "==", Meetings[host_id].hostEmail)
            .get()
            .then((querySnapshot) => {
              querySnapshot.forEach((doc) => {
                  // save record to data base
                db.collection("Records").add({
                  'Events': Meetings[host_id].recordLog,
                  'MeetingID': Meetings[host_id].meetingId,
                  'useruid': String(doc.id),
                  'MeetingName': Meetings[host_id].meetingName,
                  'MeetingStart': Meetings[host_id].meetingStart,
                  'MeetingEnd' : new Date()
                })
                    .then((docRef) => {
                        console.log("Document written with ID: ", docRef.id);
                        // add meeting end to message log
                        Meetings[host_id].messageLog.push("meeting.ended");
                        // update firebase messages after meeting end to let client know that meeting has ended
                        db.collection("CurrentMeetings").doc(Meetings[host_id].hostUID).set({
                            messages: Meetings[host_id].messageLog
                        }).then(()=>{
                            //delete the current meeting when meeting has ended
                            db.collection("CurrentMeetings").doc(Meetings[host_id].hostUID).delete().then(() => {
                                // delete local dictionary values of meeting
                                delete Meetings[host_id]
                            }).catch((error) => {
                                console.error("error deleting Current Meeting document")
                            });
                        }).catch((error)=>{
                            console.error("error updating current meeting" + " email: " + participantEmail + " in meeting participant joined")
                        })
                    })
                    .catch((error) => {
                      console.error("Error adding document: ", error);
                    });
              });
            })
            .catch((error) => {
              console.log("Error getting documents: ", error);
            });
      }
      else if(Meetings[host_id]){
          delete Meetings[host_id]
      }
    }
}

app.post('/api/requests', (req, res) => {
  res.status(200)
  res.send()
  if(req.headers.authorization === process.env.zoom_verification_token){
    handleZoomPost(req)
  }
})

app.post('/deauthorize', (req, res) => {
  if (req.headers.authorization === process.env.zoom_verification_token) {
    res.status(200)
    res.send()
    request({
      url: 'https://api.zoom.us/oauth/data/compliance',
      method: 'POST',
      json: true,
      body: {
        'client_id': req.body.payload.client_id,
        'user_id': req.body.payload.user_id,
        'account_id': req.body.payload.account_id,
        'deauthorization_event_received': req.body.payload,
        'compliance_completed': true
      },
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Basic ' + Buffer.from(process.env.zoom_client_id + ':' + process.env.zoom_client_secret).toString('base64'),
        'cache-control': 'no-cache'
      }
    }, (error, httpResponse, body) => {
      if (error) {
        console.log(error)
      } else {
        console.log(body)
      }
    })
  } else {
    res.status(401)
    res.send()
  }
})


const server = app.listen(port, () => console.log(`Server Up and Running on ${port}!`))
server.on('upgrade', (request, socket, head) => {
    wsServer.handleUpgrade(request, socket, head, socket => {
        wsServer.emit('connection', socket, request);
    });
});
